@{
    ViewData["Title"] = "Support";
    var name = (ViewData["SupportName"] as string) ?? "";
    var email = (ViewData["SupportEmail"] as string) ?? "";
}

<div class="max-w-3xl mx-auto p-4 sm:p-6">
    <div class="card bg-base-100 border border-base-300 shadow-xl">
        <div class="card-body p-6 sm:p-8">

            <div class="flex items-start justify-between gap-4">
                <div class="min-w-0">
                    <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">Contact Support</h1>
                    <p class="text-sm opacity-70 mt-2">
                        Send a message to the admins. Your account details are included automatically.
                    </p>
                </div>

                <div class="hidden sm:flex items-center justify-center w-12 h-12 rounded-2xl bg-primary/15 text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M18 10c0-3.314-2.686-6-6-6S6 6.686 6 10v3a4 4 0 004 4h4a4 4 0 004-4v-3zM8 21h8" />
                    </svg>
                </div>
            </div>

            @if (TempData["SuccessMessage"] is string successMsg)
            {
                <div class="alert alert-success mt-5">
                    <span>@successMsg</span>
                </div>
            }
            else if (TempData["ErrorMessage"] is string errorMsg)
            {
                <div class="alert alert-error mt-5">
                    <span>@errorMsg</span>
                </div>
            }

            <div class="divider my-6"></div>

            <form asp-action="SendSupportEmail" method="post" class="space-y-4" id="supportForm">
                @Html.AntiForgeryToken()

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label pb-1"><span class="label-text">Name</span></label>
                        <input class="input input-bordered w-full opacity-90"
                               value="@name"
                               disabled />
                        <input type="hidden" name="Name" value="@name" />
                    </div>

                    <div class="form-control">
                        <label class="label pb-1"><span class="label-text">Email</span></label>
                        <input class="input input-bordered w-full opacity-90"
                               value="@email"
                               disabled />
                        <input type="hidden" name="Email" value="@email" />
                    </div>
                </div>

                <!-- subject -->
                <div class="form-control">
                    <label class="label pb-1">
                        <span class="label-text">Subject</span>
                        <span class="label-text-alt opacity-60">Keep it short</span>
                    </label>
                    <input name="Subject"
                           class="input input-bordered w-full"
                           placeholder="e.g. Can't verify / Match history missing"
                           maxlength="120"
                           required />
                </div>

                <!-- message -->
                <div class="form-control">
                    <label class="label pb-1">
                        <span class="label-text">Message</span>
                        <span class="label-text-alt opacity-60"><span id="msgCount">0</span>/2000</span>
                    </label>
                    <textarea name="Message"
                              id="msg"
                              class="textarea textarea-bordered w-full h-44"
                              placeholder="Explain what happened. Include usernames, time, screenshot info, etc."
                              maxlength="2000"
                              required></textarea>
                </div>

                <div class="flex flex-col sm:flex-row gap-3 pt-2">
                    <button class="btn btn-primary flex-1" id="sendBtn" type="submit">
                        Send Message
                    </button>

                    <a class="btn btn-ghost flex-1 sm:flex-none" asp-controller="Home" asp-action="Index">
                        Cancel
                    </a>
                </div>

                <p class="text-xs opacity-60 pt-2">
                    Tip: Don’t share passwords. If you’re reporting a player, include their username and match time.
                </p>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function(){
            const msg = document.getElementById("msg");
            const msgCount = document.getElementById("msgCount");
            const form = document.getElementById("supportForm");
            const btn = document.getElementById("sendBtn");

            function updateCount(){
                if(!msg || !msgCount) return;
                msgCount.textContent = String((msg.value || "").length);
            }

            msg?.addEventListener("input", updateCount);
            updateCount();

            form?.addEventListener("submit", () => {
                if (!btn) return;
                btn.disabled = true;
                btn.classList.add("btn-disabled");
                btn.textContent = "Sending...";
            });
        })();
    </script>
}
